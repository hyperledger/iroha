# Generated by `iroha_swarm`.
# You should not edit this manually.
# Seed: Iroha

services:
  builder:
    image: hyperledger/iroha:local
    build: ../..
    pull_policy: never
    command: echo ok
  irohad0:
    depends_on:
    - builder
    image: hyperledger/iroha:local
    pull_policy: never
    environment:
      CHAIN: 00000000-0000-0000-0000-000000000000
      PUBLIC_KEY: ed0120A98BAFB0663CE08D75EBD506FEC38A84E576A7C9B0897693ED4B04FD9EF2D18D
      PRIVATE_KEY: 802640A4DFC16789FBF9A588525E4AC7F791AC51B12AEE8919EACC03EB2FC31D32C692A98BAFB0663CE08D75EBD506FEC38A84E576A7C9B0897693ED4B04FD9EF2D18D
      P2P_ADDRESS: 0.0.0.0:1337
      API_ADDRESS: 0.0.0.0:8080
      GENESIS_PUBLIC_KEY: ed01204164BF554923ECE1FD412D241036D863A6AE430476C898248B8237D77534CFC4
      GENESIS_PRIVATE_KEY: 80264082B3BDE54AEBECA4146257DA0DE8D59D8E46D5FE34887DCD8072866792FCB3AD4164BF554923ECE1FD412D241036D863A6AE430476C898248B8237D77534CFC4
      GENESIS_SIGNED_FILE: /tmp/genesis.signed.scale
    ports:
    - 1337:1337
    - 8080:8080
    volumes:
    - ./:/config
    init: true
    healthcheck:
      test: test $(curl -s http://127.0.0.1:8080/status/blocks) -gt 0
      interval: 2s
      timeout: 1s
      retries: 30
      start_period: 4s
    command: |-
      /bin/sh -c "
        kagami genesis sign /config/genesis.json --public-key $$GENESIS_PUBLIC_KEY --private-key $$GENESIS_PRIVATE_KEY --out-file $$GENESIS_SIGNED_FILE &&
        irohad --submit-genesis
      "
